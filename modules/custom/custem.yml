type: module
info:
  id: recon-openredirect
  name: Open Redirect Detection
  description: Crawl and test for open redirects
  author: charlie
vars:
  target:
    required: true
  payloads:
    default: "/home/defaut/toolkit/web/loxs/payloads/or.txt"
  threads:
    default: 50
  depth:
    default: 3
  header:
    default: "User-Agent: Mozilla/5.0"
steps:
  # Phase 1: Crawl URLs and save to file
  - name: katana_enum
    tool: katana
    args: "-u {{target}} -d {{depth}} -aff -xhr -fx -sb -H '{{header}}' -cos '.*\\/logout.*' -silent"
  # Phase 2: Inject payloads into each URL
  - name: inject_payloads
    tool: /bin/bash
    args: "-c 'cat {{payloads}} | while read payload; do cat {{katana_enum.output}} | zap \"$payload\"; done'"
    depends_on: [katana_enum]
    timeout: "1h"
  # Phase 3: Test with httpx
  - name: httpx_test
    tool: httpx
    args: " -fr -mr 'google.com' -location -H '{{header}}' -random-agent -threads {{threads}}"
    stdin: true
    depends_on: [inject_payloads]
