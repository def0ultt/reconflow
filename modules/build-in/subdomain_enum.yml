ype: module
info:
  id: subdomain-enum
  name: Subdomain Enumeration
  tag: recon
  description: Multi-tool subdomain enumeration pipeline
  author: default
vars:
  target:
    required: true
    description: Target domain
  resolvers:
    required: true
    description: List of resolvers
  chaos_api_key:   # <--- ADDED THIS
    required: false
    description: Chaos API Key (optional)
  ports:
    required: false
    default: "80,443,81,8080,8083,8443,8888,9090"
    description: Ports to scan
steps:
  - name: subfinder
    tool: subfinder
    # tool: subfinder  <--- REMOVED DUPLICATE
    args: "-d {{target}} -all -silent"
  - name: assetfinder
    tool: assetfinder
    args: "-subs-only {{target}}"
  - name: chaos
    tool: chaos
    args: "-d {{target}} -silent -key {{chaos_api_key}}"
    condition: "{chaos_api_key}"
  - name: findomain
    tool: findomain
    args: "-t {{target}} -q"
  - name: anew
    tool: anew
    args: ""
    stdin: true
    depends_on: [subfinder, assetfinder, chaos, findomain]
  - name: alterx
    tool: alterx
    args: "-l {{anew.output}}"
    depends_on: [anew]
  - name: anew2
    tool: anew
    args: ""
    stdin: true
    depends_on: [alterx]
  - name: live_subdomain
    tool: dnsx
    args: "-l {{anew2.output}} -r {{resolvers}} -j"
    depends_on: [anew2]
  - name : live_web_server
    tool: httpx
    args: "{-l {{targets}}||-u {{target}} } -title -status-code -content-length -location  -p {{ports}}  -j "
  - name: rm_file
    tool: rm
    # Use 'or ""' to handle skipped steps returning None
    args: "{{subfinder.output or ''}} {{assetfinder.output or ''}} {{findomain.output or ''}} {{chaos.output or ''}} {{anew.output or ''}}"
    depends_on: [dnsx]

